<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Turbo Quiz Overlay</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:transparent;overflow:hidden}

.container{
    width:100%;
    height:100vh;
    background:linear-gradient(135deg,rgba(30,60,114,.95),rgba(42,82,152,.95),rgba(126,34,206,.95));
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:10px;
    position:relative
}

.animated-bg{position:absolute;inset:0;pointer-events:none}
.circle{position:absolute;border-radius:50%;background:rgba(255,255,255,.1);animation:float 20s infinite}
.circle:nth-child(1){width:150px;height:150px;top:5%;left:-20px}
.circle:nth-child(2){width:100px;height:100px;top:40%;right:-20px;animation-delay:5s}
.circle:nth-child(3){width:80px;height:80px;bottom:10%;left:10%;animation-delay:10s}

@keyframes float{
    0%,100%{transform:translate(0,0)}
    50%{transform:translate(20px,-20px)}
}

.header{text-align:center;margin:10px 0;z-index:2}
.title{font-size:32px;color:#fff;font-weight:800;text-shadow:0 0 15px #00d4ff}
.subtitle{font-size:16px;color:#ffd700}

.time-top-right{position:absolute;top:10px;right:10px;z-index:3}
.info-box{background:rgba(255,255,255,.2);padding:6px 12px;border-radius:10px}
.info-value{color:#fff;font-size:20px;font-weight:700}

.main-content{width:100%;max-width:600px;flex:1;display:flex;flex-direction:column;justify-content:center;z-index:2}

.question-box{
    background:rgba(255,255,255,.15);
    border-radius:20px;
    padding:15px;
    margin-bottom:15px;
    text-align:center
}
.question-number{color:#ffd700;font-size:16px;margin-bottom:8px}
.question-text{color:#fff;font-size:22px;font-weight:700}

.answers-grid{display:grid;gap:10px}

.answer-box{
    background:rgba(255,255,255,.2);
    border-radius:15px;
    padding:12px;
    display:flex;
    align-items:center;
    gap:12px
}
.answer-box.correct{background:linear-gradient(90deg,#2ecc71,#27ae60)}
.answer-box.incorrect{opacity:.4}

.answer-letter{
    width:36px;height:36px;border-radius:50%;
    background:#667eea;color:#fff;
    display:flex;align-items:center;justify-content:center;
    font-weight:700
}
.answer-text{color:#fff;flex:1;font-size:16px;line-height:1.2}
.answer-percent{min-width:45px;color:#fff;font-weight:800;text-align:right}

.leaderboard{
    width:100%;max-width:600px;
    background:rgba(0,0,0,.3);
    border-radius:12px;
    padding:10px;
    margin-top:10px;
    z-index:2
}
.leaderboard h3{text-align:center;color:#ffd700;font-size:14px;margin-bottom:5px}
.leaderboard-list{list-style:none;max-height:25vh;overflow-y:auto}
.leaderboard-item{
    display:flex;align-items:center;
    padding:4px 8px;font-size:13px;
    margin-bottom:4px;border-radius:6px;
    background:rgba(255,255,255,.05)
}
.leaderboard-item.top1{background:#ffd36b;color:#111}
.leaderboard-item.top2{background:#e6e6e6;color:#111}
.leaderboard-item.top3{background:#d9a06a;color:#111}

.rank{width:20px;font-weight:700}
.name{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.score{font-weight:700}

@media(max-width:480px){
    .animated-bg{display:none}
}
</style>
</head>

<body>
<div class="container">

<div class="animated-bg">
    <div class="circle"></div><div class="circle"></div><div class="circle"></div>
</div>

<div class="time-top-right"><div class="info-box"><div class="info-value">0:00</div></div></div>

<div class="header">
    <div class="title">Turbo Quiz DE</div>
    <div class="subtitle">Teste dein Wissen!</div>
</div>

<div class="main-content">
    <div class="question-box">
        <div class="question-number"></div>
        <div class="question-text">Warte auf Frageâ€¦</div>
    </div>
    <div class="answers-grid"></div>
</div>

<div class="leaderboard">
    <h3>Bestenliste</h3>
    <ul class="leaderboard-list"></ul>
</div>

</div>

<script>
(() => {

const dom = {
    timer: document.querySelector('.info-value'),
    qNum: document.querySelector('.question-number'),
    qText: document.querySelector('.question-text'),
    answers: document.querySelector('.answers-grid'),
    leaderboard: document.querySelector('.leaderboard-list')
};

const audio = {
    queue: [],
    playing: false,
    current: null,
    music: null
};

function resetAudio(){
    audio.queue.length = 0;
    if(audio.current){ audio.current.pause(); audio.current=null; }
    audio.playing=false;
}

function playNext(){
    if(audio.playing || !audio.queue.length) return;
    audio.playing=true;
    const {url} = audio.queue.shift();
    const a = new Audio(url);
    audio.current=a;
    a.onended=()=>{audio.playing=false;playNext()};
    a.onerror=()=>{audio.playing=false;playNext()};
    a.play().catch(()=>{audio.playing=false;playNext()});
}

function addAudio(url){
    if(audio.queue.length>5) audio.queue.length=0;
    audio.queue.push({url});
    playNext();
}

function format(sec){
    const m=Math.floor(sec/60);
    return `${m}:${(sec%60).toString().padStart(2,'0')}`;
}

const handlers = {

timer:d=>{
    dom.timer.textContent=format(d.seconds||0);
},

question:d=>{
    resetAudio();
    dom.qNum.textContent=d.topic||`Frage ${d.current}/${d.total}`;
    dom.qText.textContent=d.text||'';
    dom.answers.innerHTML='';
    (d.options||[]).forEach(o=>{
        dom.answers.innerHTML+=`
        <div class="answer-box">
            <div class="answer-letter">${o.letter}</div>
            <div class="answer-text">${o.text}</div>
            <div class="answer-percent">0%</div>
        </div>`;
    });
},

votes:d=>{
    document.querySelectorAll('.answer-box').forEach(b=>{
        const l=b.querySelector('.answer-letter').textContent;
        b.querySelector('.answer-percent').textContent=(d.percentages?.[l]||0)+'%';
    });
},

answer:d=>{
    document.querySelectorAll('.answer-box').forEach(b=>{
        const l=b.querySelector('.answer-letter').textContent;
        b.classList.toggle('correct',l===d.correct_letter);
        b.classList.toggle('incorrect',l!==d.correct_letter);
    });
},

scores:d=>{
    dom.leaderboard.innerHTML='';
    d.leaderboard.forEach((e,i)=>{
        dom.leaderboard.innerHTML+=`
        <li class="leaderboard-item ${i<3?'top'+(i+1):''}">
            <span class="rank">${i+1}.</span>
            <span class="name">${e.username}</span>
            <span class="score">${e.score}</span>
        </li>`;
    });
},

audio:d=>{
    if(d.audio) addAudio(d.audio);
}

};

function connect(){
    const ws=new WebSocket((location.protocol==='https:'?'wss':'ws')+'://'+location.host);
    ws.onmessage=e=>{
        let d; try{d=JSON.parse(e.data)}catch{return}
        handlers[d.type]?.(d);
    };
    ws.onclose=()=>setTimeout(connect,1000);
}

connect();
})();
</script>
</body>
</html>
